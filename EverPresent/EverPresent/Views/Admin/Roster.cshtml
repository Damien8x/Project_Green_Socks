@model EverPresent.Models.StudentViewModel
@Scripts.Render("~/Scripts/script.js")
@Scripts.Render("~/Scripts/bootsrtap.js")


@{

    int count = 0;
}


<h2>Students</h2>

@*Display Students names and their favorite Mogwai*@
<div class="container">
    <div class="row text-center">

        @{
            if (Model.StudentList == null || !Model.StudentList.Any())
            {
                <br />
                <p>No Mogwai in the System</p>
                <br />
            }
            else
            {

                foreach (var item in Model.StudentList)
                {

                    <div class="col-sm-2">
                        @{ count++; string id = "id" + count;}
                        <!--If a student is clicked, the header and line graph will change-->
                        <p id=@id value=@item.Name onclick="clickedStudent(this)">
                            <img src="~/image/@item.AvatarId" width="75" height="75" />
                        </p>

                        <br />
                        <span>
                            @item.Name
                        </span>

                    </div>
                }
            }
        }

    </div>
    <br />

    <h2 id="head">Click a Student above to view Attendance Profile</h2>

</div>

<head>
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!-- Numeric JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>
</head>

<body>
    @*Display line graph*@
    <div id="myDiv"><!-- Plotly chart will be drawn inside this DIV --></div>

    @*Display editable Attendance table -- only shown if "Edit Attendance" button is clicked*@
    <div id="time" class="container-fluid" style="width:50%; display:none" align="left">
        <div class="row">

            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>@DateTime.Today.ToString("D")</th>
                            <th>Signed In</th>
                            <th>Signed Out</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td contenteditable="true">9:15 am</td>
                            <td contenteditable="true">11:09 am</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td contenteditable="true">12:28 pm</td>
                            <td contenteditable="true">2:45 pm</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        @*Hide Attendance table*@
        <button onclick="document.getElementById('time').style.display = 'none'" class="btn btn-default">Close</button>
    </div>

    @*Display Edit Student Form -- only shown if "Edit Student" button is clicked*@
    <div id="editStudent" class="container-fluid" style="display:none">
        <form class="form-horizontal" role="form">
            <div class="row">
                <div class="col-sm-6 col-lg-4">
                    <div class="form-group">
                        <label class="col-md-4 control-label" for="inputEmail">Edit Name:</label>
                        <div class="col-md-8">
                            <input class="form-control" id="inputEmail" type="email" placeholder="Name">
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6 col-lg-4">
                    <div class="form-group">
                        <label class="col-md-4 control-label" for="inputMogwai">Edit Mogwai:</label>
                        <div class="col-md-8">
                            <input class="form-control" id="inputMogwai" type="email" placeholder="Mogwai">
                        </div>
                    </div>
                </div>
            </div>
            @*Hide Editing Form*@
            <button onclick="document.getElementById('editStudent').style.display = 'none'" class="btn btn-default">
                Submit
            </button>
            <button onclick="document.getElementById('editStudent').style.display = 'none'" class="btn btn-default">
                Cancel
            </button>
        </form>
    </div><!-- /.container -->

    @*Display Add Tokens Form -- only shown if "Add Tokens" button is clicked*@
    <div id="addTokens" class="container-fluid" style="display:none">
        <form class="form-horizontal" role="form">
            <div class="row">
                <div class="col-sm-6 col-lg-4">
                    <div class="form-group">
                        <label class="col-md-4 control-label" for="inputTokens">Add tokens:</label>
                        <div class="col-md-8">
                            <input class="form-control" id="inputTokens" type="email" placeholder="# tokens">
                        </div>
                    </div>
                </div>
                @*Hide Tokens Form*@
                <button onclick="document.getElementById('addTokens').style.display = 'none'" class="btn btn-default">
                    Submit
                </button>
                <button onclick="document.getElementById('addTokens').style.display = 'none'" class="btn btn-default">
                    Cancel
                </button>
            </div>
        </form>
    </div><!-- /.container -->

    @*Display pie charts*@
    <div id="secondDiv" style="width:60%; float:left"><!-- Plotly chart will be drawn inside this DIV --></div>

    @*Hidden until a student is clicked*@
    <div id="cal" style="width:40%; float:right; visibility:hidden">
        @*Display calendar*@
        <iframe src="https://calendar.google.com/calendar/embed?title=Middle%20College&amp;showTitle=0&amp;showPrint=0&amp;showCalendars=0&amp;showTz=0&amp;height=600&amp;wkst=1&amp;bgcolor=%23999999&amp;src=g692kkkicuib1h345hp43732i4%40group.calendar.google.com&amp;color=%230a2b0e&amp;ctz=America%2FLos_Angeles" style=" border:solid 1px #777" width="400" height="400" frameborder="0" scrolling="no"></iframe>

        @*Edit Calendar button*@
        @Html.ActionLink("Edit Calendar", "Calendar", "Admin", routeValues: null, htmlAttributes: new { id = "registerLink", @class = "btn btn-default" })

        @*Generate Report button*@
        @Html.ActionLink("Generate Report", "GenerateReports", "Admin", routeValues: null, htmlAttributes: new { id = "registerLink", @class = "btn btn-default" })

        @*Edit Attendance button*@
        <button id="timeButton" class="btn btn-default" onclick="
            document.getElementById('time').style.display = 'block'" style="visibility:hidden">
            Edit Attendance
        </button>

        @*Edit Student button*@
        <button id="registerLink" class="btn btn-default" onclick="
            document.getElementById('editStudent').style.display = 'block'">
            Edit Student
        </button>

        @*Add tokens button*@
        <button id="registerLink" class="btn btn-default" onclick="
            document.getElementById('addTokens').style.display = 'block'">
            Add Tokens
        </button>

    </div>

    <script>
        var n = 4;
        var y = [];

        function clickedStudent(student) {
            // make the calendar visible
            document.getElementById("cal").style.visibility = "visible";
            document.getElementById("timeButton").style.visibility = "visible";
            document.getElementById('head').innerHTML = student.getAttribute("value");

            // randomize points on line graph
            for (i = 0; i < n; i++) {
                y[i] = Math.random() * 100;
            }
            var StudentAttendance = {
                x: [1, 2, 3, 4],
                y: y,
                type: 'scatter',
                name: 'Student Attendance'
            };
            var AverageAttendance = {
                x: [1, 2, 3, 4],
                y: [100, 90, 95, 88],
                type: 'scatter',
                name: 'Average Attendance'
            };
            var data = [AverageAttendance, StudentAttendance];
            // plot the data for the line graph
            Plotly.newPlot('myDiv', data);

            var data = [{
                values: [85, 15],
                labels: ['85%', '15%'],
                domain: {
                    x: [0, .48]
                },
                name: 'Attendance',
                text: 'Attendance',
                textposition: 'inside',
                hoverinfo: 'label+percent+name',
                hole: .4,
                type: 'pie'
            }, {
                values: [25, 75],
                labels: ['25%', '75%'],
                domain: { x: [.52, 1] },
                name: 'On Time',
                text: 'On Time',
                textposition: 'inside',
                hoverinfo: 'label+percent+name',
                hole: .4,
                type: 'pie'
            }];

            var layout = {
                annotations: [
                    {
                        font: {
                            size: 13
                        },
                        showarrow: false,
                        x: 0.16,
                        y: 0.5,
                        text: 'Attendance'
                    },
                    {
                        font: {
                            size: 13
                        },
                        showarrow: false,
                        x: 0.81,
                        y: 0.5,
                        text: 'On Time'
                    }
                ]
            };
            // plot the data for the pie charts
            Plotly.newPlot('secondDiv', data, layout);
        }

    </script>

</body>
